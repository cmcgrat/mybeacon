<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyBeacon Admin</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, sans-serif; background: #0B1120; color: #F1F5F9; padding: 40px 24px; }
  .container { max-width: 700px; margin: 0 auto; }
  h1 { font-size: 24px; margin-bottom: 4px; }
  .sub { color: #64748B; margin-bottom: 32px; font-size: 14px; }
  .live-dot { display: inline-block; width: 8px; height: 8px; background: #34D399; border-radius: 50%; margin-right: 6px; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }
  .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 24px; }
  .stat-card { background: #131B2E; border: 1px solid rgba(148,163,184,0.1); border-radius: 14px; padding: 20px; }
  .stat-label { font-size: 11px; color: #64748B; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
  .stat-num { font-size: 36px; font-weight: 700; }
  .stat-num.teal { color: #14B8A6; }
  .stat-num.amber { color: #FBBF24; }
  .stat-num.green { color: #34D399; }
  .card { background: #131B2E; border: 1px solid rgba(148,163,184,0.1); border-radius: 14px; padding: 20px; margin-bottom: 16px; }
  .card h2 { font-size: 12px; color: #64748B; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 14px; }
  .country-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(148,163,184,0.06); font-size: 14px; }
  .country-row:last-child { border: none; }
  .country-flag { margin-right: 8px; }
  .country-count { font-weight: 600; color: #14B8A6; }
  .scan-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(148,163,184,0.06); font-size: 13px; }
  .scan-item:last-child { border: none; }
  .scan-time { color: #64748B; }
  .scan-detail { text-align: right; }
  .scan-score { font-weight: 700; }
  .scan-score.red { color: #F87171; }
  .scan-score.amber { color: #FBBF24; }
  .scan-score.green { color: #34D399; }
  .scan-breaches { color: #94A3B8; font-size: 12px; }
  .refresh { background: #14B8A6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; }
  .refresh:hover { background: #0D9488; }
  .updated { color: #64748B; font-size: 12px; margin-left: 12px; }
  .bottom-bar { display: flex; align-items: center; margin-top: 16px; }
  @media (max-width: 600px) { .stats-row { grid-template-columns: 1fr; } .stat-num { font-size: 28px; } }
</style>
</head>
<body>
<div class="container">
  <h1>MyBeacon Dashboard</h1>
  <p class="sub"><span class="live-dot"></span>Live scan tracker ‚Äî auto-refreshes every 10s</p>

  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-label">Total Scans</div>
      <div class="stat-num teal" id="total">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Today</div>
      <div class="stat-num green" id="today">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Yesterday</div>
      <div class="stat-num amber" id="yesterday">--</div>
    </div>
  </div>

  <div class="card">
    <h2>Countries</h2>
    <div id="countries">Loading...</div>
  </div>

  <div class="card">
    <h2>Recent Scans</h2>
    <div id="recent">Loading...</div>
  </div>

  <div class="bottom-bar">
    <button class="refresh" onclick="load()">Refresh</button>
    <span class="updated" id="updated"></span>
  </div>
</div>

<script>
const flags = { US: 'üá∫üá∏', GB: 'üá¨üáß', CA: 'üá®üá¶', AU: 'üá¶üá∫', DE: 'üá©üá™', unknown: 'üåç' };
const names = { US: 'United States', GB: 'United Kingdom', CA: 'Canada', AU: 'Australia', DE: 'Germany', unknown: 'Other' };

async function load() {
  try {
    const r = await fetch('/api/stats');
    const d = await r.json();

    document.getElementById('total').textContent = d.totalScans.toLocaleString();
    document.getElementById('today').textContent = d.todayScans.toLocaleString();
    document.getElementById('yesterday').textContent = d.yesterdayScans.toLocaleString();

    // Countries
    const sorted = Object.entries(d.countries).filter(([,v]) => v > 0).sort((a,b) => b[1] - a[1]);
    document.getElementById('countries').innerHTML = sorted.length ? sorted.map(([code, count]) =>
      `<div class="country-row"><span><span class="country-flag">${flags[code] || 'üåç'}</span>${names[code] || code}</span><span class="country-count">${count}</span></div>`
    ).join('') : '<div style="color:#64748B">No data yet</div>';

    // Recent scans
    document.getElementById('recent').innerHTML = d.recentScans.length ? d.recentScans.map(s => {
      const time = new Date(s.t).toLocaleString();
      const cls = s.s < 500 ? 'red' : s.s < 700 ? 'amber' : 'green';
      return `<div class="scan-item"><span class="scan-time">${flags[s.c] || 'üåç'} ${time}</span><div class="scan-detail"><span class="scan-score ${cls}">${s.s}</span><div class="scan-breaches">${s.b} breaches</div></div></div>`;
    }).join('') : '<div style="color:#64748B">No scans yet</div>';

    document.getElementById('updated').textContent = 'Updated ' + new Date().toLocaleTimeString();
  } catch (e) {
    document.getElementById('total').textContent = 'Error';
  }
}

load();
setInterval(load, 10000);
</script>
</body>
</html>
